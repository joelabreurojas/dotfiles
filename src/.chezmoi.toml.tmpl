{{- $email := "joelabreurojas@gmail.com" -}}
{{- if eq .chezmoi.os "windows" -}}
{{-     $email = "jabreu@transmandu.com" -}}
{{- end -}}

{{- $os_id := .chezmoi.os -}}
{{- if (and (eq .chezmoi.os "linux") (hasKey .chezmoi.osRelease "id")) -}}
{{-     $os_id = printf "%s-%s" .chezmoi.os .chezmoi.osRelease.id -}}
{{- end -}}

{{- $ephemeral := false -}}
{{- if or (env "CODESPACES") (env "REMOTE_CONTAINERS") (env "SSH_CONNECTION") (env "KUBERNETES_SERVICE_HOST") (env "container") (stat "/.dockerenv") -}}
{{-     $ephemeral = true -}}
{{- end -}}

[data]
    name = "Joel Abreu Rojas"
    email = {{ $email | quote }}
    os_id = {{ $os_id | quote }}
    ephemeral = {{ $ephemeral }}

    [data.packages]
        linux = [
            "git", "build-essential", "unzip", "jq", "zsh", "ripgrep"
        ]
        windows = [
            "Git.Git", "Microsoft.PowerShell", "BurntSushi.ripgrep", "sharkdp.fd"
        ]

[bitwarden]
    command = "bw"
    {{- if not $ephemeral }}
    unlock = "auto"
    {{- end }}

[edit]
    apply = true

{{- if not $ephemeral }}
[git]
    autoCommit = true
    autoPush = true
{{- end }}

{{- if eq .chezmoi.os "windows" -}}
[interpreters.ps1]
    command = "pwsh"
    args = ["-NoLogo"]
{{- end -}}
